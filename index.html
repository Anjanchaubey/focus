<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Focus Workspace</title>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* Root variables for a modern, vibrant vibe */
    /* Root variables for a modern, vibrant vibe */
:root {
  --primary-color: #4a90e2;
  --primary-color-dark: #3a78c2;
  --secondary-color: #50e3c2;
  --secondary-color-dark: #3ec3a2;
  --background-color: #f0f4f8;
  --card-bg: #ffffff;
  --text-color: #333333;
  --accent-color: #f5a623;
  --accent-color-dark: #e4961d;
}

/* Global reset and body styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
body {
  font-family: 'Poppins', sans-serif;
  background: var(--background-color);
  color: var(--text-color);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}

/* Authentication Section */
#auth-section {
  max-width: 400px;
  margin: 5vh auto;
  padding: 2rem;
  background: var(--card-bg);
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  text-align: center;
  transition: transform 0.3s ease-in-out;
}
#auth-section:hover {
  transform: scale(1.02);
}
#auth-section h2 {
  margin-bottom: 1.5rem;
  font-size: 1.8rem;
  color: var(--primary-color);
}
#auth-section input,
#auth-section button {
  width: 100%;
  padding: 0.8rem;
  margin: 0.5rem 0;
  border: 1px solid #ddd;
  border-radius: 5px;
  font-size: 1rem;
}
#auth-section button {
  background: var(--primary-color);
  color: #fff;
  border: none;
  cursor: pointer;
  transition: background 0.3s;
}
#auth-section button:hover {
  background: var(--primary-color-dark);
}

/* Toggle Sidebar Button */
#toggle-sidebar-btn {
  position: fixed;
  top: 10px;
  left: 10px;
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  z-index: 1100;
  color: var(--primary-color);
}

/* Main Content Layout */
#main-content {
  display: flex;
  flex-wrap: nowrap;
  min-height: 100vh;
}

/* Sidebar Section */
#sidebar {
  width: 260px;
  flex-shrink: 0;
  background: var(--card-bg);
  padding: 2rem 1rem;
  box-shadow: 2px 0 15px rgba(0,0,0,0.1);
  overflow-y: auto;
  position: relative;
  transition: transform 0.3s ease-in-out;
}
#sidebar.closed {
  transform: translateX(-100%);
}
/* Header with plus icon for task adding */
#sidebar h3 {
  position: relative;
  margin: 25px 0 1rem;
  font-size: 1.4rem;
  color: var(--primary-color);
}
#add-task-icon {
  position: absolute;
  right: 0;
  top: 0;
  cursor: pointer;
  font-size: 1.2rem;
  color: var(--primary-color);
}
/* Remove inline task input/button; now tasks are added via popup */

/* Sidebar common elements */
#sidebar input,
#sidebar button {
  width: 100%;
  padding: 0.6rem;
  margin: 0.5rem 0;
  border: 1px solid #ddd;
  border-radius: 5px;
  font-size: 0.9rem;
}
#sidebar button {
  background: var(--secondary-color);
  color: #fff;
  border: none;
  cursor: pointer;
  transition: background 0.3s;
}
#sidebar button:hover {
  background: var(--secondary-color-dark);
}

/* Task List Styling */
#todo-list {
  list-style: none;
  margin-top: 1rem;
}
#todo-list li {
  display: flex;
  align-items: center;
  padding: 0.5rem 0;
  border-bottom: 1px solid #eee;
}
/* Delete icon aligned to far left with no margins */
#todo-list li .delete-task {
  order: 2;
  text-align: right;
  background: none;
  border: none;
  padding: 0;
  margin: 0;
  color: #999;
  cursor: pointer;
  font-size: 1rem;
}
/* Custom Checkbox Styling */
#todo-list li input[type="checkbox"] {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  border: 2px solid #ccc;
  border-radius: 4px;
  margin: 0 10px;
  position: relative;
  cursor: pointer;
  order: 1;
  border: 1px solid black;
}
#todo-list li input[type="checkbox"]:checked {
  background-color: var(--secondary-color);
  border-color: var(--secondary-color);
}
#todo-list li input[type="checkbox"]:checked::after {
  content: 'âœ“';
  color: #fff;
  position: absolute;
  top: -2px;
  left: 3px;
  font-size: 14px;
}
/* Task text styling */
#todo-list li .task-text {
  flex-grow: 1;
  order: 1;
  width: 800%;
  font-size: 15px;
  font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
}

/* Resizer for sidebar */
#resizer {
  width: 5px;
  cursor: ew-resize;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  background: transparent;
}

/* Total Focus Time */
#total-focus-time {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  text-align: left;
  padding: 0.5rem;
  border-top: 1px solid #eee;
  font-size: 1rem;
  color: var(--text-color);
}

/* Timer Section */
#timer-section {
  flex: 1;
  padding: 2rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
}
/* Focus Button */
#focus-btn {
  --b: 3px;
  --s: 0.6em;
  --color: #4169E1;
  
  padding: calc(0.7em + var(--s)) calc(1.1em + var(--s));
  color: var(--color);
  --_p: var(--s);
  background: conic-gradient(
      from 90deg at var(--b) var(--b),
      #0000 90deg,
      var(--color) 0
    )
    var(--_p) var(--_p) / calc(100% - var(--b) - 2*var(--_p))
    calc(100% - var(--b) - 2*var(--_p));
  transition: transform 0.2s ease-in-out, background 0.3s linear;
  outline: var(--b) solid #0000;
  outline-offset: 0.6em;
  font-size: 20px;
  border: 0;
  user-select: none;
  touch-action: manipulation;
}

#focus-btn:hover,
#focus-btn:focus-visible {
  --_p: 0px;
  outline-color: var(--color);
  outline-offset: 0.05em;
  transform: scale(1.05); /* Slight pop on hover */
}
#focus-btn:active {
  background: var(--color);
  color: #fff;
  transform: scale(0.95); /* Pop-in on click */
}

/* Progress Container */
#progress-container {
  display: none;
  text-align: center;
  position: relative;
  width: 350px; /* Increased size */
  height: 350px; /* Increased size */
}
#progress-wrapper {
  position: relative;
  display: inline-block;
}
/* Big SVG Progress Ring */
#progress-ring {
  transform: rotate(-90deg);
  transition: stroke-dashoffset 1s linear; /* Smooth animation */
}
/* Timer Display centered inside progress ring */
#timer-display {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 3rem;
  font-weight: bold;
  color: var(--primary-color);
}
/* Timer Controls (Pause & Stop) at bottom */
#timer-controls {
  margin-top: 2rem;
}
#pause-timer-btn,
#stop-timer-btn {
  padding: 0.8rem 1.2rem;
  margin: 0 0.5rem;
  border: none;
  border-radius: 5px;
  font-size: 1rem;
  cursor: pointer;
  background: var(--primary-color);
  color: #fff;
  transition: background 0.3s;
}
#pause-timer-btn:hover,
#stop-timer-btn:hover {
  background: var(--primary-color-dark);
}

/* Modal Popup for Timer Settings and Task Adding */
#timer-modal,
#task-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(5px);
  align-items: center;
  justify-content: center;
  z-index: 1200;
  animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Modal Content Styling */
.modal-content {
  background: var(--card-bg);
  padding: 2rem;
  border-radius: 10px;
  text-align: center;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  animation: slideIn 0.4s ease-in-out;
  border: 2px solid var(--primary-color);
}

@keyframes slideIn {
  from { transform: translateY(-30px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.modal-content input,
.modal-content select,
.modal-content button {
  width: 100%;
  padding: 0.8rem;
  margin: 0.5rem 0;
  border: 1px solid #ddd;
  border-radius: 5px;
  font-size: 1rem;
  transition: border-color 0.3s, box-shadow 0.3s;
}
.modal-content input:focus,
.modal-content select:focus,
.modal-content button:focus {
  border-color: var(--primary-color);
  box-shadow: 0 0 5px rgba(74,144,226,0.5);
}
.modal-content button {
  background: var(--primary-color);
  color: #fff;
  border: none;
  cursor: pointer;
  transition: background 0.3s, transform 0.2s;
}
.modal-content button:hover {
  background: var(--primary-color-dark);
  transform: scale(1.03);
}
.modal-content button:active {
  transform: scale(0.98);
}

/* Responsive Design */
@media (max-width: 768px) {
  #main-content {
    flex-direction: column;
  }
  #sidebar {
    width: 100%;
    box-shadow: none;
  }
  #timer-section {
    padding: 1rem;
  }
}

/* Profile Icon Styling */
#profile-icon {
  position: fixed;
  top: 10px;
  right: 10px;
  cursor: pointer;
  z-index: 1100;
}
#profile-icon img {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
}

/* Modal for Profile Details */
#profile-modal {
  display: none;
  position: fixed;
  z-index: 1200;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(5px);
  align-items: center;
  justify-content: center;
}
#profile-modal .modal-content {
  background: var(--card-bg);
  padding: 2rem;
  border-radius: 10px;
  text-align: center;
  width: 90%;
  max-width: 400px;
  position: relative;
}
#modal-close-profile {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 1.5rem;
  cursor: pointer;
}
#modal-profile-img {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  object-fit: cover;
  margin-bottom: 1rem;
}
#modal-profile-email {
  font-size: 1.2rem;
  color: var(--text-color);
  margin-bottom: 1rem;
}
/* Change Profile Picture Button */
#change-profile-pic-btn {
  margin-top: 1rem;
  padding: 0.5rem 1rem;
  border: none;
  background: var(--primary-color);
  color: #fff;
  border-radius: 5px;
  cursor: pointer;
  transition: background 0.3s;
}
#change-profile-pic-btn:hover {
  background: var(--primary-color-dark);
}

#about {
    margin-top: 1rem;
  padding: 0.5rem 1rem;
  border: none;
  background: var(--primary-color);
  color: #fff;
  border-radius: 5px;
  cursor: pointer;
  transition: background 0.3s;
    }

    #about:hover {
  background: var(--primary-color-dark);
}

a {
 text-decoration: none;
 color: black;
}

  
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }
    /* Loading Screen Styles */
    #loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      font-size: 1.5rem;
      color: #4a90e2;
    }
    /* Sidebar Resizer */
    #resizer {
      width: 5px;
      cursor: ew-resize;
      background-color: #ddd;
    }
    /* Modal Styles */
    .modal-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 400px;
      position: relative;
    }
    #profile-modal, #timer-modal, #task-modal {
      display: none;
      position: fixed;
      z-index: 1100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.4);
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading-screen">
    Loading...
  </div>

  <!-- Authentication Section -->
  <div id="auth-section">
    <h2>Sign In / Sign Up</h2>
    <input type="email" id="email" placeholder="Email" /><br />
    <input type="password" id="password" placeholder="Password" /><br />
    <button id="sign-in-btn">Sign In</button>
    <button id="sign-up-btn">Sign Up</button>
    <button id="google-sign-in-btn">Sign in with Google</button>
  </div>

  <!-- Toggle Sidebar Button -->
  <button id="toggle-sidebar-btn"><i class="fa-solid fa-bars"></i></button>

  <!-- Main Content: To-Do List and Focus Timer -->
  <div id="main-content" style="display: none;">
    <!-- Sidebar Section -->
    <div id="sidebar">
      <h3>
        To-Do List 
        <i class="fa-solid fa-plus" id="add-task-icon"></i>
      </h3>
      <ul id="todo-list"></ul>
      <!-- Resizer element -->
      <div id="resizer"></div>
      <!-- Total Focus Time -->
      <div id="total-focus-time">
        Total focus time today: <span id="total-time">0</span> minutes
      </div>
    </div>

    <!-- Focus Timer Section -->
    <div id="timer-section">
      <!-- Focus Button -->
      <button id="focus-btn">Focus</button>

      <!-- Profile Icon (Top Right Corner) -->
      <div id="profile-icon" style="display: none;">
        <img id="profile-img" src="" alt="Profile Photo">
      </div>
      
      <!-- Profile Details Modal -->
      <div id="profile-modal">
        <div class="modal-content">
          <span id="modal-close-profile" style="cursor: pointer; position: absolute; top: 10px; right: 15px;">&times;</span>
          <img id="modal-profile-img" src="" alt="Profile Photo">
          <h3 id="modal-profile-email"></h3>
          <button id="change-profile-pic-btn">Change Profile Picture</button>
          <div id="about">
            <a href="about.html"><i class="fa-solid fa-circle-info"></i> About</a>
          </div>
        </div>
      </div>

      <!-- Progress Container with Big Round Progress Ring & Timer -->
      <div id="progress-container">
        <div id="progress-wrapper">
          <svg id="progress-ring" width="300" height="300">
            <!-- Background Circle (grey) -->
            <circle cx="150" cy="150" r="140" stroke="#ccc" stroke-width="15" fill="none" />
            <!-- Progress Circle (royal blue) -->
            <circle id="progress-ring-circle" cx="150" cy="150" r="140" stroke="royalblue" stroke-width="15" fill="none" stroke-linecap="round" />
          </svg>
          <div id="timer-display">00:00</div>
        </div>
        <!-- Timer Controls at Bottom -->
        <div id="timer-controls">
          <button id="pause-timer-btn" style="display: none;">Pause</button>
          <button id="stop-timer-btn" style="display: none;">Stop</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Popup for Timer Settings -->
  <div id="timer-modal">
    <div class="modal-content">
      <h2>Set Focus Time</h2>
      <input type="number" id="modal-duration" placeholder="Duration (minutes)" /><br />
      <select id="modal-task-select">
        <option value="">Select a task</option>
      </select><br />
      <button id="modal-start-btn">Start</button>
      <button id="modal-close-btn">Cancel</button>
    </div>
  </div>

  <!-- Modal Popup for Adding New Task -->
  <div id="task-modal">
    <div class="modal-content">
      <h2>Add New Task</h2>
      <input type="text" id="task-input" placeholder="Task name" />
      <button id="task-add-btn">Add Task</button>
      <button id="task-cancel-btn">Cancel</button>
    </div>
  </div>

  <!-- Firebase Libraries -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // Unregister service workers to avoid caching issues
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(registrations => {
        registrations.forEach(reg => reg.unregister());
      });
    }

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCYY2GQqS0tCXb7Oxw8AWXhpexq9e8VRUs",
      authDomain: "aspirehub-32863.firebaseapp.com",
      databaseURL: "https://aspirehub-32863-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "aspirehub-32863",
      storageBucket: "aspirehub-32863",
      messagingSenderId: "686810111182",
      appId: "1:686810111182:web:4290b4b1b6e64934ec449f",
      measurementId: "G-KX41R0SSMY"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Listen for auth state changes
    firebase.auth().onAuthStateChanged(user => {
      // Hide loading screen when auth state is confirmed
      document.getElementById('loading-screen').style.display = 'none';



      if (user) {
        // Hide auth section and display main content
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('main-content').style.display = 'flex';
        loadTodos(user.uid);
        loadFocusSessions(user.uid);

        // Setup profile icon and modal details
        const profileIcon = document.getElementById('profile-icon');
        const profileImg = document.getElementById('profile-img');
        const modalProfileImg = document.getElementById('modal-profile-img');
        const modalProfileEmail = document.getElementById('modal-profile-email');
        
        const photoURL = user.photoURL ? user.photoURL : 'https://via.placeholder.com/40';
        profileImg.src = photoURL;
        modalProfileImg.src = user.photoURL ? user.photoURL : 'https://via.placeholder.com/80';
        modalProfileEmail.textContent = user.email;
        profileIcon.style.display = 'block';
      } else {
        // If no user, show auth section
        document.getElementById('profile-icon').style.display = 'none';
        document.getElementById('auth-section').style.display = 'block';
        document.getElementById('main-content').style.display = 'none';
      }
    });

    // Open profile modal on profile icon click
    document.getElementById('profile-icon').addEventListener('click', () => {
      document.getElementById('profile-modal').style.display = 'flex';
    });

    // Close profile modal on clicking the close icon
    document.getElementById('modal-close-profile').addEventListener('click', () => {
      document.getElementById('profile-modal').style.display = 'none';
    });

    // Optional: Close modal if clicking outside modal content
    window.addEventListener('click', (e) => {
      const modal = document.getElementById('profile-modal');
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });

    // Allow changing the profile picture via a prompt for a new image URL
    document.getElementById('change-profile-pic-btn').addEventListener('click', () => {
      const newPhotoURL = prompt('Enter new profile picture URL:');
      if (newPhotoURL) {
        firebase.auth().currentUser.updateProfile({
          photoURL: newPhotoURL
        }).then(() => {
          // Update the profile icon and modal with the new photo
          document.getElementById('profile-img').src = newPhotoURL;
          document.getElementById('modal-profile-img').src = newPhotoURL;
          alert('Profile picture updated!');
        }).catch(error => {
          alert('Error updating profile picture: ' + error.message);
        });
      }
    });

    // Sign In
    document.getElementById('sign-in-btn').addEventListener('click', () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      firebase.auth().signInWithEmailAndPassword(email, password).catch(error => {
        alert(error.message);
      });
    });

    // Sign Up
    document.getElementById('sign-up-btn').addEventListener('click', () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      firebase.auth().createUserWithEmailAndPassword(email, password).catch(error => {
        alert(error.message);
      });
    });

    // Google Sign-In
    document.getElementById('google-sign-in-btn').addEventListener('click', () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider).catch(error => {
        alert(error.message);
      });
    });

 // Sidebar toggle with animation
const toggleBtn = document.getElementById('toggle-sidebar-btn');
const sidebar = document.getElementById('sidebar');
let sidebarVisible = true;

toggleBtn.addEventListener('click', () => {
  if (sidebarVisible) {
    // Add class to hide the sidebar with animation
    sidebar.style.transition = 'transform 0.5s ease, opacity 0.5s ease'; // Smooth animation
    sidebar.style.transform = 'translateX(-100%)'; // Slide it out of view
    sidebar.style.opacity = '0'; // Fade out

    setTimeout(() => {
      sidebar.style.display = 'none'; // Completely hide it after animation
    }, 500); // Set delay matching the animation time
    sidebarVisible = false;
  } else {
    // Show the sidebar with animation
    sidebar.style.display = 'block'; // Show it instantly
    setTimeout(() => {
      sidebar.style.transition = 'transform 0.5s ease, opacity 0.5s ease'; // Smooth animation
      sidebar.style.transform = 'translateX(0)'; // Slide it back into view
      sidebar.style.opacity = '1'; // Fade in
    }, 10); // Add a slight delay to trigger the transition
    sidebarVisible = true;
  }
});


    // Resizer for sidebar
    const resizer = document.getElementById('resizer');
    let startX, startWidth;
    resizer.addEventListener('mousedown', initResize, false);
    function initResize(e) {
      startX = e.clientX;
      startWidth = parseInt(document.defaultView.getComputedStyle(sidebar).width, 10);
      document.documentElement.addEventListener('mousemove', doResize, false);
      document.documentElement.addEventListener('mouseup', stopResize, false);
    }
    function doResize(e) {
      const newWidth = startWidth + e.clientX - startX;
      sidebar.style.width = newWidth + 'px';
    }
    function stopResize(e) {
      document.documentElement.removeEventListener('mousemove', doResize, false);
      document.documentElement.removeEventListener('mouseup', stopResize, false);
      localStorage.setItem('sidebarWidth', sidebar.style.width);
    }
    document.addEventListener('DOMContentLoaded', () => {
      const savedWidth = localStorage.getItem('sidebarWidth');
      if (savedWidth) {
        sidebar.style.width = savedWidth;
      }
    });

    // To-Do List: Load tasks
    function loadTodos(uid) {
      const todosRef = db.ref(`users/${uid}/todos`);
      todosRef.on('value', snapshot => {
        const todos = snapshot.val() || {};
        const todoList = document.getElementById('todo-list');
        todoList.innerHTML = '';
        const modalTaskSelect = document.getElementById('modal-task-select');
        modalTaskSelect.innerHTML = '<option value="">Select a task</option>';
        for (let id in todos) {
          const todo = todos[id];
          const li = document.createElement('li');

          // Delete icon inserted at the very left
          const deleteBtn = document.createElement('button');
          deleteBtn.classList.add('delete-task');
          deleteBtn.innerHTML = '<i class="fa-solid fa-ellipsis"></i>';
          deleteBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to delete this task?')) {
              todosRef.child(id).remove();
            }
          });
          li.appendChild(deleteBtn);

          // Checkbox
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = todo.completed;
          checkbox.addEventListener('change', () => {
            todosRef.child(id).update({ completed: checkbox.checked });
          });
          li.appendChild(checkbox);

          // Task text
          const textSpan = document.createElement('span');
          textSpan.classList.add('task-text');
          textSpan.textContent = todo.text;
          if (todo.completed) {
            textSpan.style.textDecoration = 'line-through';
          }
          li.appendChild(textSpan);

          todoList.appendChild(li);

          // Populate modal task select dropdown
          const option = document.createElement('option');
          option.value = id;
          option.textContent = todo.text;
          modalTaskSelect.appendChild(option);
        }
      });
    }

    // Sidebar: Open Task Adding Modal when plus icon is clicked
    document.getElementById('add-task-icon').addEventListener('click', () => {
      document.getElementById('task-modal').style.display = 'flex';
    });

    // Task Modal: Add Task
    document.getElementById('task-add-btn').addEventListener('click', () => {
      const taskName = document.getElementById('task-input').value;
      if (!taskName) {
        alert('Please enter a task name');
        return;
      }
      const uid = firebase.auth().currentUser.uid;
      const todosRef = db.ref(`users/${uid}/todos`);
      todosRef.push({ text: taskName, completed: false });
      document.getElementById('task-input').value = '';
      document.getElementById('task-modal').style.display = 'none';
    });
    // Task Modal: Cancel adding task
    document.getElementById('task-cancel-btn').addEventListener('click', () => {
      document.getElementById('task-modal').style.display = 'none';
    });

    // Timer Variables
    let timerInterval;
    let remainingTime;
    let isRunning = false;
    let selectedTaskId;
    let startTime;
    let timerDuration; // in minutes

    // Progress Ring Variables
    const progressCircle = document.getElementById('progress-ring-circle');
    const radius = progressCircle.r.baseVal.value;
    const circumference = 2 * Math.PI * radius;
    progressCircle.style.strokeDasharray = circumference;
    progressCircle.style.strokeDashoffset = circumference;

    // Show Timer Modal on Focus button click
    document.getElementById('focus-btn').addEventListener('click', () => {
      document.getElementById('timer-modal').style.display = 'flex';
    });
    // Close Timer Modal on Cancel
    document.getElementById('modal-close-btn').addEventListener('click', () => {
      document.getElementById('timer-modal').style.display = 'none';
    });
    // Start Timer from Modal
    document.getElementById('modal-start-btn').addEventListener('click', () => {
      const inputDuration = parseInt(document.getElementById('modal-duration').value);
      if (!inputDuration || inputDuration <= 0) {
        alert('Please enter a valid duration');
        return;
      }
      timerDuration = inputDuration;
      selectedTaskId = document.getElementById('modal-task-select').value;
      if (!selectedTaskId) {
        alert('Please select a task');
        return;
      }
      remainingTime = timerDuration * 60;
      startTime = Date.now();
      updateTimerDisplay();
      startTimer();
      document.getElementById('timer-modal').style.display = 'none';
      document.getElementById('focus-btn').style.display = 'none';
      document.getElementById('progress-container').style.display = 'block';
      document.getElementById('pause-timer-btn').style.display = 'inline';
      document.getElementById('stop-timer-btn').style.display = 'inline';
    });

    // Start Timer Function
    function startTimer() {
      isRunning = true;
      timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        remainingTime = timerDuration * 60 - elapsed;
        if (remainingTime <= 0) {
          clearInterval(timerInterval);
          isRunning = false;
          saveFocusSession(startTime, Date.now(), timerDuration * 60, selectedTaskId);
          alert('Timer finished!');
          resetTimer();
        }
        updateTimerDisplay();
        updateProgress();
      }, 1000);
    }

    // Update Timer Display (mm:ss)
    function updateTimerDisplay() {
      const minutes = Math.floor(remainingTime / 60);
      const seconds = remainingTime % 60;
      document.getElementById('timer-display').textContent =
        `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    }

    // Update Progress Ring
   // In the updateProgress function, adjust the strokeDashoffset
function updateProgress() {
  const progress = (timerDuration * 60 - remainingTime) / (timerDuration * 60);
  const offset = circumference - progress * circumference;
  
  // Smooth transition for the progress circle
  progressCircle.style.transition = 'stroke-dashoffset 0.5s ease';
  progressCircle.style.strokeDashoffset = offset;
}


    // Pause / Resume Timer (also via space bar)
    document.getElementById('pause-timer-btn').addEventListener('click', togglePause);
    function togglePause() {
      if (isRunning) {
        clearInterval(timerInterval);
        isRunning = false;
        document.getElementById('pause-timer-btn').textContent = 'Resume';
      } else {
        startTime = Date.now() - (timerDuration * 60 - remainingTime) * 1000;
        startTimer();
        document.getElementById('pause-timer-btn').textContent = 'Pause';
      }
    }
    // Stop Timer
    document.getElementById('stop-timer-btn').addEventListener('click', () => {
      clearInterval(timerInterval);
      isRunning = false;
      resetTimer();
    });

    // Reset Timer UI
    function resetTimer() {
      document.getElementById('pause-timer-btn').style.display = 'none';
      document.getElementById('stop-timer-btn').style.display = 'none';
      document.getElementById('timer-display').textContent = '00:00';
      document.getElementById('modal-duration').value = '';
      document.getElementById('modal-task-select').value = '';
      document.getElementById('pause-timer-btn').textContent = 'Pause';
      progressCircle.style.strokeDashoffset = circumference;
      document.getElementById('focus-btn').style.display = 'inline';
      document.getElementById('progress-container').style.display = 'none';
    }

    // Save Focus Session in DB
    function saveFocusSession(startTime, endTime, duration, taskId) {
      const uid = firebase.auth().currentUser.uid;
      const focusSessionsRef = db.ref(`users/${uid}/focusSessions`);
      focusSessionsRef.push({
        startTime: startTime,
        endTime: endTime,
        duration: duration,
        taskId: taskId
      });
    }

    // Load Focus Sessions to calculate total focus time
    function loadFocusSessions(uid) {
      const focusSessionsRef = db.ref(`users/${uid}/focusSessions`);
      focusSessionsRef.on('value', snapshot => {
        const focusSessions = snapshot.val() || {};
        const totalTime = getTotalFocusTimeToday(focusSessions);
        document.getElementById('total-time').textContent = Math.floor(totalTime / 60);
      });
    }
    function getTotalFocusTimeToday(focusSessions) {
      const now = new Date();
      const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
      const endOfDay = startOfDay + 24 * 60 * 60 * 1000;
      let total = 0;
      for (let id in focusSessions) {
        const session = focusSessions[id];
        if (session.startTime >= startOfDay && session.startTime < endOfDay) {
          total += session.duration;
        }
      }
      return total;
    }

    // Space bar to toggle pause/resume
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space' && document.getElementById('pause-timer-btn').style.display !== 'none') {
        e.preventDefault();
        togglePause();
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
  // Load saved width from localStorage (if any)
  const savedWidth = localStorage.getItem('sidebarWidth');
  if (savedWidth) {
    sidebar.style.width = savedWidth;
  }

  // Set initial sidebar visibility based on screen width
  if (window.innerWidth < 768) { // mobile threshold; adjust as needed
    sidebar.style.display = 'none';
    sidebarVisible = false;
  } else {
    sidebar.style.display = 'block';
    sidebarVisible = true;
  }
});

  </script>
</body>
</html>
